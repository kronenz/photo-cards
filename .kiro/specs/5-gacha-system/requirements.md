# Gacha System - Requirements

## 1. Overview

한국프로야구 홀로그래픽 카드 갓챠(뽑기) 시스템. 축구 게임 스타일의 특수 애니메이션 효과와 함께 카드를 수집하는 핵심 게임 플레이 기능.

**목표**: 사용자에게 흥미롭고 중독성 있는 카드 수집 경험 제공

**핵심 가치**:
- 🎰 **흥미진진한 뽑기 경험**: 축구 게임 스타일의 고급 애니메이션
- 🎁 **공정한 확률 시스템**: 투명하게 공개된 희귀도별 확률
- ⚡ **빠른 스킵 기능**: 원하면 애니메이션 건너뛰기 가능
- 🏆 **희귀도별 차별화**: 레전더리 카드의 특별한 연출

---

## 2. User Stories

### 2.1 카드 뽑기

**User Story 1: 단일 뽑기**
```
AS A 사용자
I WANT TO 1장의 카드를 뽑고 싶다
SO THAT 적은 재화로도 운을 시험해볼 수 있다

Acceptance Criteria:
- WHEN 사용자가 "1장 뽑기" 버튼을 클릭하면
  THEN 티켓 1장 또는 프리미엄 재화 100이 차감된다
  AND 1장의 랜덤 카드가 생성된다
  AND 물음표 카드 회전 애니메이션이 재생된다
  AND 약 2초 후 카드가 공개된다

- WHEN 재화가 부족한 상태에서 클릭하면
  THEN "재화가 부족합니다" 에러 메시지가 표시된다
  AND 버튼이 비활성화된다
```

**User Story 2: 10장 연속 뽑기**
```
AS A 사용자
I WANT TO 10장의 카드를 한번에 뽑고 싶다
SO THAT 더 효율적이고 보너스를 받을 수 있다

Acceptance Criteria:
- WHEN 사용자가 "10장 뽑기" 버튼을 클릭하면
  THEN 티켓 10장 또는 프리미엄 재화 900이 차감된다 (10% 할인)
  AND 10장의 랜덤 카드가 생성된다
  AND 최소 1장의 Epic 이상 카드가 보장된다
  AND 소환진 애니메이션 후 10장이 순차적으로 공개된다
  AND 마지막 카드는 특별 연출로 공개된다

- WHEN 재화가 부족한 상태에서 클릭하면
  THEN "재화가 부족합니다" 에러 메시지가 표시된다
  AND 필요한 재화 정보가 표시된다
```

### 2.2 애니메이션 경험

**User Story 3: 풀 애니메이션 감상**
```
AS A 사용자
I WANT TO 카드 뽑기의 화려한 애니메이션을 감상하고 싶다
SO THAT 뽑기의 흥분과 기대감을 느낄 수 있다

Acceptance Criteria:
- WHEN 뽑기가 시작되면
  THEN Stage 1: 소환진이 빛나며 회전한다 (1초)
  AND Stage 2: 카드들이 화면에 나타나 정렬된다
  AND Stage 3: 각 카드가 Y축 180도 회전하며 공개된다 (카드당 0.8초)
  AND Stage 4: 희귀도별 파티클 효과가 재생된다
  AND Stage 5: 모든 카드가 정렬되어 표시된다

- WHEN Legendary 카드가 나오면
  THEN 금색 빛 폭발 효과가 재생된다
  AND 카메라가 줌인된다
  AND 특수 사운드가 재생된다
  AND 화면 전체가 금색으로 빛난다
```

**User Story 4: 애니메이션 스킵**
```
AS A 급한 사용자
I WANT TO 애니메이션을 건너뛰고 싶다
SO THAT 빠르게 결과를 확인할 수 있다

Acceptance Criteria:
- WHEN 애니메이션 중 "Skip" 버튼을 클릭하면
  THEN 현재 진행 중인 애니메이션이 즉시 종료된다
  AND 모든 카드가 즉시 공개된 상태로 표시된다
  AND 결과 화면으로 이동한다

- WHEN ESC 키를 누르면
  THEN Skip 버튼을 누른 것과 동일하게 동작한다

- WHEN Space 키를 누르면
  THEN Skip 버튼을 누른 것과 동일하게 동작한다

- WHEN 이미 결과 화면에 있으면
  THEN Skip 버튼이 표시되지 않는다
```

### 2.3 확률 및 정보

**User Story 5: 확률 정보 확인**
```
AS A 사용자
I WANT TO 각 희귀도별 확률을 알고 싶다
SO THAT 공정한 뽑기인지 확인할 수 있다

Acceptance Criteria:
- WHEN "확률 정보" 버튼을 클릭하면
  THEN 모달이 열리며 희귀도별 확률이 표시된다
  AND Common: 60%, Rare: 25%, Epic: 12%, Legendary: 3%가 표시된다
  AND 10장 뽑기 보너스 정보가 표시된다
  AND 법적 고지사항이 표시된다

- WHEN 모달 외부를 클릭하면
  THEN 모달이 닫힌다
```

**User Story 6: 뽑기 히스토리**
```
AS A 사용자
I WANT TO 최근 뽑기 결과를 확인하고 싶다
SO THAT 내 운을 분석할 수 있다

Acceptance Criteria:
- WHEN "히스토리" 탭을 클릭하면
  THEN 최근 10회 뽑기 결과가 표시된다
  AND 각 회차별로 획득한 카드 목록이 표시된다
  AND 희귀도별 획득 통계가 표시된다
  AND 총 뽑기 횟수가 표시된다

- WHEN 통계 섹션을 보면
  THEN 희귀도별 획득 비율이 차트로 표시된다
  AND 평균 희귀도가 표시된다
  AND 레전더리 획득까지 남은 피티 카운터가 표시된다
```

### 2.4 재화 관리

**User Story 7: 재화 확인 및 획득**
```
AS A 사용자
I WANT TO 내 재화를 확인하고 획득하고 싶다
SO THAT 뽑기를 계속할 수 있다

Acceptance Criteria:
- WHEN 갓챠 페이지에 접속하면
  THEN 상단에 보유 티켓 수가 표시된다
  AND 보유 프리미엄 재화가 표시된다
  AND 각 재화로 몇 번 뽑을 수 있는지 표시된다

- WHEN 티켓이 부족하면
  THEN "티켓 획득" 버튼이 활성화된다
  AND 버튼을 클릭하면 획득 방법 모달이 열린다
  AND 일일 무료 티켓, 광고 시청, 구매 옵션이 표시된다

- WHEN 일일 무료 티켓을 수령하면
  THEN 티켓 1장이 지급된다
  AND "내일 00:00에 다시 받을 수 있습니다" 메시지가 표시된다
```

---

## 3. Functional Requirements

### 3.1 뽑기 시스템 (FR-GACHA-001)

**FR-GACHA-001-01: 단일 뽑기**
- 티켓 1장 또는 프리미엄 재화 100 소비
- 1장의 랜덤 카드 생성
- 확률: Common 60%, Rare 25%, Epic 12%, Legendary 3%
- 애니메이션 시간: 약 2초

**FR-GACHA-001-02: 10장 뽑기**
- 티켓 10장 또는 프리미엄 재화 900 소비 (10% 할인)
- 10장의 랜덤 카드 생성
- 최소 1장의 Epic 이상 보장
- 애니메이션 시간: 약 10초 (스킵 가능)

**FR-GACHA-001-03: 확률 계산**
- 각 카드는 독립적으로 확률 계산
- 가중치 랜덤 알고리즘 사용
- 10장 뽑기 시 Epic 보장 로직 적용
- 피티 시스템: 100회 누적 시 Legendary 보장

### 3.2 애니메이션 시스템 (FR-GACHA-002)

**FR-GACHA-002-01: Pulling Stage**
- 소환진 회전 애니메이션 (1초)
- 카드 등장 효과
- 화면 중앙 정렬

**FR-GACHA-002-02: Revealing Stage**
- 카드 Y축 180도 회전 (0.8초)
- 순차적 공개 (카드 간 0.1초 간격)
- 희귀도별 파티클 효과

**FR-GACHA-002-03: 희귀도별 연출**
- Common: 흰색 빛, 작은 불꽃 (10개)
- Rare: 파란 빛, 별 파티클 (20개)
- Epic: 보라 빛, 다이아몬드 파티클 (40개)
- Legendary: 금색 폭발, 번개 파티클 (80개) + 특수 연출

**FR-GACHA-002-04: 스킵 기능**
- Skip 버튼 클릭 시 즉시 결과 표시
- 단축키: ESC, Space
- 애니메이션 중에만 버튼 표시

### 3.3 재화 시스템 (FR-GACHA-003)

**FR-GACHA-003-01: 티켓 시스템**
- 일일 무료 티켓: 1장 (00:00 리셋)
- 광고 시청: +1 티켓 (하루 최대 5회)
- 이벤트 보상: 가변

**FR-GACHA-003-02: 프리미엄 재화**
- 결제를 통한 구매
- 단일 뽑기: 100
- 10장 뽑기: 900 (10% 할인)

**FR-GACHA-003-03: 재화 표시**
- 상단 헤더에 항상 표시
- 실시간 업데이트
- 부족 시 획득 방법 안내

### 3.4 결과 관리 (FR-GACHA-004)

**FR-GACHA-004-01: 카드 저장**
- 뽑은 카드는 즉시 컬렉션에 추가
- 중복 카드는 "강화 소재"로 전환 가능
- 서버 동기화

**FR-GACHA-004-02: 히스토리 저장**
- 최근 100회 뽑기 기록 저장
- 희귀도별 통계 계산
- 피티 카운터 추적

**FR-GACHA-004-03: 알림**
- Legendary 획득 시 전체 알림
- 중복 카드 안내
- 컬렉션 완성도 업데이트

---

## 4. Non-Functional Requirements

### 4.1 성능 (NFR-GACHA-001)

**NFR-GACHA-001-01: 애니메이션 성능**
- 60fps 유지 필수
- 모바일에서도 30fps 이상
- 파티클 개수 동적 조정 (디바이스 성능에 따라)

**NFR-GACHA-001-02: 로딩 시간**
- 페이지 로딩: 2초 이내
- 뽑기 시작: 즉시 (서버 검증 후 애니메이션)
- 결과 저장: 3초 이내

### 4.2 사용성 (NFR-GACHA-002)

**NFR-GACHA-002-01: 반응형 디자인**
- Desktop: 1920x1080 최적화
- Tablet: 768x1024 레이아웃 조정
- Mobile: 375x667 터치 최적화

**NFR-GACHA-002-02: 접근성**
- 키보드 네비게이션 지원
- 스크린 리더 호환
- 색각 이상자 고려 (희귀도 아이콘)

### 4.3 보안 (NFR-GACHA-003)

**NFR-GACHA-003-01: 서버 검증**
- 뽑기 결과는 서버에서 생성
- 클라이언트는 애니메이션만 담당
- 재화 차감 서버 검증

**NFR-GACHA-003-02: 확률 조작 방지**
- 확률 엔진 서버사이드 구현
- 뽑기 결과 해시 검증
- 어뷰징 탐지 시스템

### 4.4 법적 준수 (NFR-GACHA-004)

**NFR-GACHA-004-01: 확률형 아이템 규제**
- 확률 정보 명시적 공개
- 자율 규제 가이드라인 준수
- 미성년자 보호 장치

**NFR-GACHA-004-02: 개인정보**
- 뽑기 기록 개인정보 처리 동의
- 히스토리 삭제 기능 제공
- GDPR 준수

---

## 5. Technical Constraints

### 5.1 플랫폼
- SvelteKit 4.2.12
- TypeScript
- 60fps 애니메이션 (CSS Transform + requestAnimationFrame)

### 5.2 브라우저 지원
- Chrome 90+
- Safari 14+
- Firefox 88+
- Edge 90+
- Mobile Safari (iOS 14+)
- Chrome Mobile (Android 10+)

### 5.3 서버 통신
- PocketBase 실시간 동기화
- WebSocket 지원 필요
- 오프라인 큐잉

---

## 6. Dependencies

### 6.1 기존 시스템
- **UnifiedCard**: 카드 렌더링
- **HolographicEffect**: 60fps 홀로그래픽 효과
- **CollectionService**: 컬렉션 관리
- **AuthService**: 사용자 인증

### 6.2 신규 컴포넌트
- **GachaEngine**: 확률 계산 엔진
- **AnimationController**: 애니메이션 오케스트레이션
- **ParticleSystem**: 파티클 효과
- **SoundManager**: 사운드 재생 (선택)

---

## 7. Acceptance Criteria Summary

### 7.1 필수 (Must Have)
- ✅ 1장/10장 뽑기 기능
- ✅ 확률 시스템 (60/25/12/3%)
- ✅ 카드 회전 애니메이션
- ✅ 희귀도별 파티클 효과
- ✅ 스킵 기능
- ✅ 재화 시스템 (티켓/프리미엄)
- ✅ 결과 저장

### 7.2 권장 (Should Have)
- ✅ 10장 뽑기 Epic 보장
- ✅ Legendary 특수 연출
- ✅ 히스토리 & 통계
- ✅ 확률 정보 공개
- ✅ 일일 무료 티켓

### 7.3 선택 (Could Have)
- 🔄 사운드 효과
- 🔄 광고 시청 티켓
- 🔄 피티 시스템 (100회 보장)
- 🔄 이벤트 픽업
- 🔄 공유 기능

### 7.4 제외 (Won't Have - v1.0)
- ❌ 실물 카드 제작 연동
- ❌ 카드 거래 시스템
- ❌ PvP 배틀 시스템
- ❌ 리그/랭킹 시스템

---

## 8. Success Metrics

### 8.1 사용자 지표
- **일일 활성 사용자(DAU)**: 목표 1,000명
- **평균 세션 시간**: 5분 이상
- **뽑기 전환율**: 신규 사용자의 80% 이상이 첫날 뽑기 시도

### 8.2 기술 지표
- **애니메이션 FPS**: 평균 58fps 이상
- **페이지 로딩**: P95 2초 이내
- **에러율**: 0.1% 이하

### 8.3 비즈니스 지표
- **ARPU (평균 사용자 수익)**: $2.00/월
- **결제 전환율**: 5% 이상
- **재방문율**: 7일 기준 40% 이상

---

## 9. Risks and Mitigations

### 9.1 기술적 리스크

**Risk 1: 애니메이션 성능**
- 영향: 낮은 사양 디바이스에서 버벅임
- 완화: 성능 측정 후 파티클 개수 동적 조정
- 대비: 저사양 모드 제공

**Risk 2: 서버 부하**
- 영향: 동시 다발적 뽑기 시 서버 과부하
- 완화: 뽑기 결과 캐싱, 큐잉 시스템
- 대비: 서버 스케일링 자동화

### 9.2 법적 리스크

**Risk 3: 확률형 아이템 규제**
- 영향: 규제 위반 시 서비스 중단
- 완화: 확률 명시, 자율 규제 준수
- 대비: 법률 자문 사전 확보

**Risk 4: 미성년자 과몰입**
- 영향: 사회적 이슈 발생
- 완화: 일일 뽑기 횟수 제한, 부모 동의
- 대비: 쿨타임 시스템, 가이드라인

---

## 10. Future Enhancements

### Phase 2 (v1.1)
- 사운드 효과 추가
- 픽업 가챠 (특정 선수 확률 UP)
- 친구와 결과 공유

### Phase 3 (v1.2)
- 시즌 이벤트 가챠
- 보너스 타임 (확률 2배)
- VIP 시스템

### Phase 4 (v2.0)
- AI 추천 가챠
- 협동 가챠 (친구와 함께)
- 실물 카드 제작 연동

---

**문서 버전**: 1.0
**작성일**: 2025-10-14
**최종 수정일**: 2025-10-14
**작성자**: Claude (with User)
**승인 대기중**: Product Owner
